pipeline
{
    agent {
        label 'DevServer'
    }
    parameters {
  choice choices: ['Staging','Prod'], name: 'Select_environment'
    }

environment { 
    NAME = "Agathian"
}

tools {
    maven 'myMaven'
    }

stages {
        stage('Build')
                {
                steps{
                    echo " This is build stage"
                    sh 'mvn clean -DskipTests=true package'
                  /*  echo "Hello $NAME ${params.LASTNAME} this First Pipeline program "
                   */ }
           
                }
            
stage ('test')
	{
parallel {
	stage('test A'){
			agent{ label 'DevServer'}
			steps{
			echo " This is test A"
			sh "mvn test"
			}
        }
			
	stage('test B'){
			steps{
			agent { label 'DevServer' }
			echo " This is test B"
			sh "mvn test"
			}
        }
			
        }  
		
 post {
        success {
        		dir("webapp/target/")
		{
		stash name: "maven-build", includes: "*.war"
		}
                }
        }  
}  

stage ('Deploy_Dev')
	{
	when {expression {params.select_environment=='DevServer'}
	beforeAgent=true}
	agent { label 'DevServer'}
	steps {
		dir("/var/wwww/html")
			{
			unstash "maven-build"
			}

		sh """
		cd /var/www/html
		jar -X webapp.war
		"""
		}
	
	}
		
  }  

}




 
